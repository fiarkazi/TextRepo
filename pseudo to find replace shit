var
 Buff,P,FT: PChar;
 BuffLen: Word;
begin
 with Sender as TFindDialog do
  begin
   GetMem(FT, Length(FindText) + 1);
   StrPCopy(FT, FindText);
   BuffLen:= Memo1.GetTextLen + 1;
   GetMem(Buff, BuffLen);
   Memo1.GetTextBuf(Buff, BuffLen);
   P:= Buff + Memo1.SelStart + Memo1.SelLength;
   P:= StrPos(P, FT);
   if P=nil then MessageBeep(0)
   else
    begin
     Memo1.SelStart:= P - Buff;
     Memo1.SelLength:= Length(FindText);
    end;
   FreeMem(FT, Length(FindText) + 1);
   FreeMem(Buff, BuffLen);
  end;
end;



procedure TForm1.ReplaceDialog1Replace(Sender: TObject);
label 10;
begin
 Memo1.HideSelection:=true;
 10:
  if pos(ReplaceDialog1.FindText,Memo1.Text)<>0 then
   begin
    Memo1.SelStart:=pos(ReplaceDialog1.FindText,Memo1.Text)-1;
    Memo1.SelLength:=Length(ReplaceDialog1.FindText);
    Memo1.SelText:=ReplaceDialog1.ReplaceText;
    goto 10;
   end;
 Memo1.HideSelection:=false;
end;



procedure TForm1.ReplaceDialog1Find(Sender: TObject);
begin
 with Sender as TReplaceDialog do
  while True do
   begin
    if Memo1.SelText <> FindText then
    FindDialog1Find(Sender);
    if Memo1.SelLength = 0 then Break;
    Memo1.SelText:= ReplaceText;
    if not (frReplaceAll in Options) then Break;
   end;
end;

end.                     
